<?xml version="1.0" encoding="UTF-8"?>
<odoo>
  <template id="report_invoice_document_inherit_warranty" inherit_id="account.report_invoice_document">

    <xpath expr="//t[@t-set='forced_vat']" position="after">
      <style>
        div[name='operation_type'] { display: none !important; }
      </style>
    </xpath>

    <xpath expr="//t[@t-set='o']" position="replace">
        <t t-set="o" t-value="o.with_context(lang='fr_FR')"/>
    </xpath>

    <xpath expr="//table[@name='invoice_line_table']//thead" position="replace">
        <thead>
            <tr>
                <th name="th_description" class="text-start">Produit</th>
                <th name="th_quantity" class="text-end">Quantité</th>
                <th name="th_priceunit" class="text-end">Prix</th>
                <th name="th_discount" class="text-end">Disc.%</th>
                <th name="th_subtotal" class="text-end">Montant</th>
            </tr>
        </thead>
    </xpath>

    <xpath expr="//table[@name='invoice_line_table']//tbody" position="replace">
        <tbody class="invoice_tbody">
            <t t-set="current_subtotal" t-value="0"/>
            <t t-foreach="o.invoice_line_ids.sorted(key=lambda l: (-l.sequence, l.date, l.move_name, -l.id), reverse=True)" t-as="line">
                <t t-if="line.display_type == 'product'">
                    <tr t-att-class="'bg-200 fw-bold o_line_section' if line.display_type == 'line_section' else 'fst-italic o_line_note' if line.display_type == 'line_note' else ''">
                        
                        <td name="account_invoice_line_name">
                            <span t-field="line.product_id.name" t-options="{'widget': 'text'}"/>
                        </td>

                        <td class="text-end">
                            <span t-esc="'%.0f' % line.quantity"/>
                            <span t-field="line.product_uom_id" groups="uom.group_uom"/>
                        </td>

                        <td class="text-end">
                            <span t-esc="'%.0f' % line.sudo().price_unit"/>
                            <span t-esc="o.currency_id.symbol"/>
                        </td>

                        <td class="text-end">
                            <span t-esc="'%.0f' % line.discount"/> %
                        </td>

                        <td class="text-end o_price_total">
                            <span t-esc="'%.0f' % line.price_total"/>
                            <span t-esc="o.currency_id.symbol"/>
                        </td>
                    </tr>
                    
                    <tr>
                         <td colspan="5" class="text-start small border-0 pt-0 text-muted">
                            <t t-if="line.include_full_service_warranty">
                                Inclut la garantie complète
                            </t>
                            <t t-else="">
                                Inclut la garantie standard
                            </t>
                        </td>
                    </tr>
                </t>

                <t t-if="line.display_type == 'line_section'">
                    <tr class="bg-200 fw-bold o_line_section">
                        <td colspan="99">
                            <span t-field="line.name" t-options="{'widget': 'text'}"/>
                        </td>
                    </tr>
                </t>
                <t t-if="line.display_type == 'line_note'">
                    <tr class="fst-italic o_line_note">
                        <td colspan="99">
                            <span t-field="line.name" t-options="{'widget': 'text'}"/>
                        </td>
                    </tr>
                </t>
            </t>
        </tbody>
    </xpath>

    <xpath expr="//div[@id='total']//div//table" position="replace">
        <table class="table table-sm table-borderless">
            <tr>
                <td><strong>Total</strong></td>
                <td class="text-end">
                    <span t-esc="'%.0f' % o.amount_untaxed"/>
                    <span t-esc="o.currency_id.symbol"/>
                </td>
            </tr>
            <tr>
                <td>TVA (20%) :</td>
                <td class="text-end">
                    <span t-esc="'%.0f' % o.amount_vat_20"/>
                    <span t-esc="o.currency_id.symbol"/>
                </td>
            </tr>
            <tr class="border-black o_total">
                <td><strong>Total TTC :</strong></td>
                <td class="text-end">
                    <strong t-esc="'%.0f' % o.amount_total_incl_vat_20"/>
                    <strong t-esc="o.currency_id.symbol"/>
                </td>
            </tr>
        </table>
    </xpath>

    <xpath expr="//div[@name='due_date']" position="replace"/>
    <xpath expr="//div[@name='origin']" position="replace"/>
    <xpath expr="//p[@name='payment_communication']" position="replace"/>
    <xpath expr="//strong[contains(text(), 'Invoice Date')]" position="replace">
      <strong>Date:</strong>
    </xpath>

    <xpath expr="//h2" position="replace">
      <h2>
        <span t-esc="o.invoice_title or (o.move_type == 'out_invoice' and 'Facture' or 'Devis')"/>
        <span> </span>
        <span t-field="o.custom_display_number"/>
      </h2>
    </xpath>

  </template>


  <template id="hide_footer_email" inherit_id="web.external_layout_standard">
    <xpath expr="//ul[contains(@class, 'list-inline')]" position="replace"/>
    <xpath expr="//div[@name='company_address']" position="replace">
        <ul class="list-unstyled" style="padding-top: 2rem">
          <li>Leasymat</li>
          <li>7 passage turquetil, 75011 Paris</li>
          <li>Téléphone : 01 48 96 24 45</li>
          <li>Email : commercial@leasymat.fr</li>
          <li>Siren :