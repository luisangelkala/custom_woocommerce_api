<?xml version="1.0" encoding="UTF-8"?>
<odoo>
  <template id="report_invoice_document_inherit_warranty" inherit_id="account.report_invoice_document">

    <xpath expr="//t[@t-set='forced_vat']" position="after">
      <style>
        div[name='operation_type'] { display: none !important; }
        .text-nowrap { white-space: nowrap; }
      </style>
    </xpath>

    <xpath expr="//t[@t-set='o']" position="replace">
        <t t-set="o" t-value="o.with_context(lang=o.partner_id.lang)"/>
    </xpath>

    <xpath expr="//table[@name='invoice_line_table']//thead" position="replace">
        <thead>
            <tr>
                <th name="th_description" class="text-start">Produit</th>
                <th name="th_quantity" class="text-end">Quantité</th>
                <th name="th_priceunit" class="text-end">Prix</th>
                <th name="th_discount" class="text-end">Disc.%</th>
                <th name="th_subtotal" class="text-end">Montant</th>
            </tr>
        </thead>
    </xpath>

    <xpath expr="//table[@name='invoice_line_table']//tbody" position="replace">
        <tbody class="invoice_tbody">
            <t t-foreach="o.invoice_line_ids.sorted(key=lambda l: (-l.sequence, l.date, l.move_name, -l.id), reverse=True)" t-as="line">
                <t t-if="not line.display_type">
                    <tr>
                        <td name="account_invoice_line_name">
                            <span t-field="line.product_id.name"/>
                        </td>

                        <td class="text-end">
                            <span t-esc="int(line.quantity or 0)"/>
                            <span t-field="line.product_uom_id"/>
                        </td>

                        <td class="text-end text-nowrap">
                            <span t-esc="int(line.sudo().price_unit or 0)"/>
                            <span t-esc="o.currency_id.symbol"/>
                        </td>

                        <td class="text-end">
                            <span t-esc="int(line.discount or 0)"/> %
                        </td>

                        <td class="text-end text-nowrap">
                            <span t-esc="int(line.price_total or 0)"/>
                            <span t-esc="o.currency_id.symbol"/>
                        </td>
                    </tr>
                    
                    <tr>
                         <td colspan="5" class="text-start small border-0 pt-0 text-muted">
                            <t t-if="line.include_full_service_warranty">Inclut la garantie complète</t>
                            <t t-else="">Inclut la garantie standard</t>
                        </td>
                    </tr>
                </t>

                <t t-if="line.display_type == 'line_section'">
                    <tr class="bg-200 fw-bold o_line_section">
                        <td colspan="99"><span t-field="line.name"/></td>
                    </tr>
                </t>
                <t t-if="line.display_type == 'line_note'">
                    <tr class="fst-italic o_line_note">
                        <td colspan="99"><span t-field="line.name"/></td>
                    </tr>
                </t>
            </t>
        </tbody>
    </xpath>

    <xpath expr="//div[@id='total']//div//table" position="replace">
        <table class="table table-sm table-borderless">
            <tr>
                <td><strong>Total</strong></td>
                <td class="text-end">
                    <span t-esc="int(o.amount_untaxed or 0)"/>
                    <span t-esc="o.currency_id.symbol"/>
                </td>
            </tr>
            <tr>
                <td>TVA (20%) :</td>
                <td class="text-end">
                    <span t-esc="int(o.amount_vat_20 or 0)"/>
                    <span t-esc="o.currency_id.symbol"/>
                </td>
            </tr>
            <tr class="border-black o_total">
                <td><strong>Total TTC :</strong></td>
                <td class="text-end">
                    <strong t-esc="int(o.amount_total_incl_vat_20 or 0)"/>
                    <strong t-esc="o.currency_id.symbol"/>
                </td>
            </tr>
        </table>
    </xpath>

    <xpath expr="//div[@name='due_date']" position="replace"/>
    <xpath expr="//div[@name='origin']" position="replace"/>
    <xpath expr="//p[@name='payment_communication']" position="replace"/>
    
    <xpath expr="//div[@name='invoice_date']" position="replace">
        <div class="col-auto col-3 mw-100 mb-2" name="invoice_date">
            <strong>Date:</strong>
            <p class="m-0" t-field="o.invoice_date"/>
        </div>
    </xpath>

    <xpath expr="//h2" position="replace">
      <h2>
        <span t-esc="o.invoice_title or 'Facture'"/>
        <span> </span>
        <span t-field="o.custom_display_number"/>
      </h2>
    </xpath>

  </template>


  <template id="hide_footer_email" inherit_id="web.external_layout_standard">
    <xpath expr="//ul[contains(@class, 'list-inline')]" position="replace"/>
    <xpath expr="//div[@name='company_address']" position="replace">
        <ul class="list-unstyled" style="padding-top: 2rem">
          <li>Leasymat</li>
          <li>7 passage turquetil, 75011 Paris</li>
        </ul>
    </xpath>
  </template>

  <template id="custom_replace_address_layout" inherit_id="web.address_layout">
    <xpath expr="." position="replace">
      <div class="row">
        <div class="col-6 offset-6 text-end">
          <ul class="list-unstyled">
            <t t-if="o and o.financing_agency_id">
              <li><strong><span t-field="o.financing_agency_id.name"/></strong></li>
              <li><span t-field="o.financing_agency_id.address"/></li>
            </t>
            <t t-else="">
              <t t-if="o and o.partner_id">
                  <li><strong><span t-field="o.partner_id.name"/></strong></li>
                  <li><span t-field="o.partner_id.contact_address"/></li>
              </t>
            </t>
          </ul>
        </div>
      </div>
    </xpath>
  </template>

</odoo>