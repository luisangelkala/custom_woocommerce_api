<?xml version="1.0" encoding="UTF-8"?>
<odoo>
  <template id="sale_order_portal_content_inherit_custom"
            inherit_id="sale.sale_order_portal_content">

    <xpath expr="//section[@id='details']" position="before">
      <style>
        #sales_order_table th#taxes_header,
        #sales_order_table td#taxes,
        #sales_order_table th.text-end[name='th_taxes'],
        #sales_order_table td.text-end[name='td_taxes'] {
          display: none !important;
        }
      </style>
    </xpath>

    <xpath expr="//table[@id='sales_order_table']//thead//th[contains(@class, 'text-end')][1]" position="replace">
        <th class="text-end">
            <span t-translate="on">Devis mensuel</span>
        </th>
    </xpath>
    
    <xpath expr="//span[@t-field='line.price_unit']" position="replace">
      <span t-field="line.effective_price_quote"
            t-options='{"widget": "monetary", "display_currency": sale_order.currency_id}'/>
    </xpath>

    <xpath expr="//span[@t-field='line.price_subtotal']" position="replace">
       <span t-esc="line.effective_price_quote * line.product_uom_qty" 
             t-options='{"widget": "monetary", "display_currency": sale_order.currency_id}'/>
    </xpath>

    <xpath expr="//div[@id='total']//div[contains(@class,'ms-auto')]" position="inside">
      <div class="d-flex justify-content-between mb-1">
        <span t-translate="on">IVA (20%):</span>
        <span t-field="sale_order.amount_vat_20"/>
      </div>
      <div class="d-flex justify-content-between">
        <strong t-translate="on">Total Incl. IVA:</strong>
        <strong t-field="sale_order.amount_total_incl_vat_20"/>
      </div>
    </xpath>

  </template>
</odoo>